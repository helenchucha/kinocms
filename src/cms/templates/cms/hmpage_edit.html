{% extends 'cms/admin_base.html' %}
{% load widget_tweaks %}
{% load i18n %}

{% block content %}
<div class="card card-info card-outline mb-4">
    <div class="card-header">
        <div class="card-title"></div>
    </div>
    <form class="needs-validation" method="post" novalidate>
        {% csrf_token %}
        {{ form_hmpage.errors }}
        {{ form_seo.errors }}
        <div class="card-body edit-form">
            <div class="row g-3 align-items-center mb-3">
                <div class="col-md-4">
                </div>

                <!-- Поле статус у вигляді перемикача -->
                <div class="col-md-4">
                    <div class="col-md-6 form-check form-switch">
                        <input type="hidden" name="status" value="False" />
                        <input
                                class="form-check-input"
                                type="checkbox"
                                id="status"
                                name="status"
                                value="True"
                                {% if form_hmpage.status.value %} checked {% endif %}
                        >
                        <label class="form-check-label" for="status">
                            <span id="status-label">{% if form_hmpage.status.value %}ВКЛ{% else %}ВЫКЛ{% endif %}</span>
                        </label>
                    </div>
                </div>

                <!-- Перемикач мови у вигляді вкладок -->
                <div class="col-md-4">
                    <ul class="nav nav-tabs" id="languageTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button
                                    class="nav-link {% if form_hmpage.language.value == 'uk' or not form_hmpage.language.value %} active {% endif %}"
                                    id="uk-tab"
                                    data-bs-toggle="tab"
                                    data-bs-target="#uk"
                                    type="button"
                                    role="tab"
                                    aria-controls="uk"
                                    aria-selected="{% if form_hmpage.language.value == 'uk' or not form_hmpage.language.value %} true {% else %} false {% endif %}"
                            >
                                Украинский
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button
                                    class="nav-link {% if form_hmpage.language.value == 'ru' %} active {% endif %}"
                                    id="ru-tab"
                                    data-bs-toggle="tab"
                                    data-bs-target="#ru"
                                    type="button"
                                    role="tab"
                                    aria-controls="ru"
                                    aria-selected="{% if form_hmpage.language.value == 'ru' %} true {% else %} false {% endif %}"
                            >
                                Русский
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="languageTabContent">
                        <div
                                class="tab-pane fade {% if form_hmpage.language.value == 'uk' or not form_hmpage.language.value %} show active {% endif %}"
                                id="uk"
                                role="tabpanel"
                                aria-labelledby="uk-tab"
                        >

                            <input type="hidden" name="language" value="uk"/>
                        </div>
                        <div
                                class="tab-pane fade {% if form_hmpage.language.value == 'ru' %} show active {% endif %}"
                                id="ru"
                                role="tabpanel"
                                aria-labelledby="ru-tab"
                        >
                            <input type="hidden" name="language" value="ru"/>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Поле Title оригінальне (приховане) -->
            {{ form_hmpage.title }}

            <!-- Поле Title (російська мова - дефолт) -->
            <div class="row g-3 mt-3" id="title-ru-group">
                <div class="col-md-4" data-lang="ru">
                    <label for="title_ru" class="form-label">{% trans "Название" %}</label>
                    <input
                            type="text"
                            class="form-control"
                            id="title_ru"
                            name="title_ru"
                            value="{{ form_hmpage.title_ru.value|default:form_hmpage.title_ru.initial }}"
                    />
                </div>
            </div>

            <!-- Поле Title (українська мова) -->
            <div class="row g-3 mt-3" id="title-uk-group" style="display: none;">
                <div class="col-md-4" data-lang="uk">
                    <label for="title_uk" class="form-label">{% trans "Название" %}</label>
                    <input
                            type="text"
                            class="form-control"
                            id="title_uk"
                            name="title_uk"
                            value="{{ form_hmpage.title_uk.value|default:form_hmpage.title_uk.initial }}"
                    />
                </div>
            </div>


            <!-- Телефон 1 -->
            <div class="row g-3 mt-3">
                <div class="col-md-3">
                    <label for="phone1" class="form-label">{% trans "Телефон 1" %}</label>
                    <input
                            type="text"
                            class="form-control"
                            id="phone1"
                            name="phone1"
                            value="{{ form_hmpage.phone1.value|default:'' }}"
                            required
                    />
                </div>
            </div>

            <!-- Телефон 2 -->
            <div class="row g-3 mt-3">
                <div class="col-md-3">
                    <label for="phone2" class="form-label">{% trans "Телефон 2" %}</label>
                    <input
                            type="text"
                            class="form-control"
                            id="phone2"
                            name="phone2"
                            value="{{ form_hmpage.phone2.value|default:'' }}"
                            required
                    />
                </div>
            </div>

            <!-- SEO текст -->
            <div class="row g-3 mt-3">
                <div class="col-12">
                    <label for="seo_text" class="form-label">{% trans "SEO текст" %}</label>
                    <textarea
                            id="seo_text"
                            name="seo_text"
                            class="form-control"
                            style="height: 100px;"
                            required
                            aria-label="SEO текст"
                    >{{ form_seo.initial.seo_text|default:'' }}</textarea>
                </div>
            </div>

            <div class="card mt-4 p-3" style="max-width: 800px; margin: 0 auto;">
                <h5 class="text-center mb-3">{% trans "SEO блок" %}</h5>

                <!-- SEO URL -->
                <div class="row g-3">
                    <div class="col-md-12">
                        <label for="seo_url" class="form-label">{% trans "SEO URL" %}</label>
                        <input
                                type="text"
                                class="form-control"
                                id="seo_url"
                                name="seo_url"
                                value="{{ form_seo.seo_url.value|default:'' }}"
                        />
                    </div>
                </div>

                <!-- SEO Title -->
                <div class="row g-3">
                    <div class="col-md-12">
                        <label for="seo_title" class="form-label">{% trans "SEO Title" %}</label>
                        <input
                                type="text"
                                class="form-control"
                                id="seo_title"
                                name="seo_title"
                                value="{{ form_seo.seo_title.value|default:'' }}"
                        />
                    </div>
                </div>

                <!-- SEO Keywords -->
                <div class="row g-3">
                    <div class="col-md-12">
                        <label for="seo_keywords" class="form-label">{% trans "SEO Keywords" %}</label>
                        <input
                                type="text"
                                class="form-control"
                                id="seo_keywords"
                                name="seo_keywords"
                                value="{{ form_seo.seo_keywords.value|default:'' }}"
                        />
                    </div>
                </div>

                <!-- SEO Description -->
                <div class="row g-3">
                    <div class="col-md-12">
                        <label for="seo_description" class="form-label">{% trans "SEO Description" %}</label>
                        <textarea
                                id="seo_description"
                                name="seo_description"
                                class="form-control"
                                style="height: 100px;"
                                aria-label="SEO Description"
                        >{{ form_seo.initial.seo_description|default:'' }}</textarea>
                    </div>
                </div>

            </div>

        </div>

        <!-- Футер -->
        <div class="card-footer">
            <button class="btn btn-info" type="submit">{% trans "Сохранить" %}</button>
            <a href="{% url 'page_list' %}" class="btn btn-secondary">{% trans "Отменить" %}</a>
        </div>
    </form>
</div>

<script>
    // Валідація Bootstrap
    (() => {
        'use strict';
        const forms = document.querySelectorAll('.needs-validation');
        Array.from(forms).forEach((form) => {
            form.addEventListener('submit', (event) => {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    })();
</script>

<script>
function showLanguageFields(lang) {
    // ховаємо всі групи
    document.querySelectorAll('#title-ru-group, #title-uk-group').forEach(group => {
        group.style.display = 'none';
    });
    // показуємо потрібне
    document.querySelector(`#title-${lang}-group`).style.display = 'block';

    // оновлюємо приховане поле з мовою (якщо потрібно)
    document.querySelector('input[name="language"]').value = lang;
}

// додати обробники натискань
document.querySelectorAll('#languageTab button').forEach(btn => {
    btn.addEventListener('click', () => {
        const lang = btn.getAttribute('data-lang') || (btn.id.includes('uk') ? 'uk' : 'ru');
        showLanguageFields(lang);
    });
});

// ініціалізація при завантаженні
document.addEventListener('DOMContentLoaded', () => {
    // визначити активну мову (залежно від значення form або за замовчуванням)
    const activeLang = document.querySelector('input[name="language"]').value || 'ru';
    showLanguageFields(activeLang);
});
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const checkbox = document.getElementById('status');
    const labelText = document.getElementById('status-label');

    function updateLabel() {
      if (checkbox.checked) {
        labelText.textContent = 'ВКЛ';
      } else {
        labelText.textContent = 'ВЫКЛ';
      }
    }

    // Початкове оновлення при завантаженні
    updateLabel();

    // Оновлюємо при зміні стану
    checkbox.addEventListener('change', updateLabel);
  });
</script>

{% endblock %}